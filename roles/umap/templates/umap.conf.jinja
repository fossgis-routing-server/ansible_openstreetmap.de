# -*- coding:utf-8 -*-

from umap.settings.base import *   # pylint: disable=W0614,W0401

SECRET_KEY = '{{ umap__django_secret_key }}'
INTERNAL_IPS = ('127.0.0.1', )
ALLOWED_HOSTS = ['{{ umap__server_url }}'] + {{ umap__additional_allowed_hosts | default([]) }}

CSRF_TRUSTED_ORIGINS = [
    'https://{{ umap__server_url }}'
]

DEBUG = False

ADMINS = (
    ('admin', '{{ umap__admin_email_address }}'),
)
MANAGERS = ADMINS

import os
os.umask(0o022)  # for .gz files from gzip_file()
FILE_UPLOAD_DIRECTORY_PERMISSIONS = 0o755 #default none
FILE_UPLOAD_PERMISSIONS = 0o644           #default 0o644

DATABASES = {
    'default': {
        'ENGINE': 'django.contrib.gis.db.backends.postgis',
        'NAME': os.getenv('POSTGRES_DB'),
        'HOST': os.getenv('POSTGRES_HOST'),
        'PORT': int(os.getenv('POSTGRES_PORT', 5432)),
        'USER': os.getenv('POSTGRES_USER'),
        'PASSWORD': os.getenv('POSTGRES_PASSWORD')
    }
}

LANGUAGE_CODE = 'de'

# Set to False if login into django account should not be possible. You can
# administer accounts in the admin interface.
ENABLE_ACCOUNT_LOGIN = False

AUTHENTICATION_BACKENDS = (
#    "social_core.backends.github.GithubOAuth2",
#    "social_core.backends.bitbucket.BitbucketOAuth",
#    "social_core.backends.twitter.TwitterOAuth",
    "social_core.backends.openstreetmap_oauth2.OpenStreetMapOAuth2",
    "django.contrib.auth.backends.ModelBackend",
)
#SOCIAL_AUTH_GITHUB_KEY = "xxx"
#SOCIAL_AUTH_GITHUB_SECRET = "xxx"
#SOCIAL_AUTH_BITBUCKET_KEY = "xxx"
#SOCIAL_AUTH_BITBUCKET_SECRET = "xxx"
#We need email to associate with other Oauth providers
#SOCIAL_AUTH_GITHUB_SCOPE = [
#    "user:email",
#]
#SOCIAL_AUTH_TWITTER_KEY = "xxx"
#SOCIAL_AUTH_TWITTER_SECRET = "xxx"
SOCIAL_AUTH_OPENSTREETMAP_OAUTH2_KEY = '{{ umap__social_auth_openstreetmap_oauth2_key }}'
SOCIAL_AUTH_OPENSTREETMAP_OAUTH2_SECRET = '{{ umap__social_auth_openstreetmap_oauth2_secret }}'
MIDDLEWARE += (
    'social_django.middleware.SocialAuthExceptionMiddleware',
)
SOCIAL_AUTH_REDIRECT_IS_HTTPS = True
SOCIAL_AUTH_RAISE_EXCEPTIONS = False
SOCIAL_AUTH_BACKEND_ERROR_URL = "/"


OPENROUTESERVICE_APIKEY = '{{ umap__openrouteservice_apikey }}'

# Suppress DisallowedHost exceptions as per Django documentation
# https://docs.djangoproject.com/en/5.2/ref/logging/#django-security-disallowedhost
LOGGING = {
    "version": 1,
    "disable_existing_loggers": False,
    "handlers": {
        "null": {
            "class": "logging.NullHandler",
        },
    },
    "loggers": {
        "django.security.DisallowedHost": {
            "handlers": ["null"],
            "propagate": False,
        },
    },
}

# If you want to add a playgroud map, add its primary key
# UMAP_DEMO_PK = 204
# If you want to add a showcase map on the home page, add its primary key
#UMAP_SHOWCASE_PK = 1952
# Add a baner to warn people this instance is not production ready.
UMAP_DEMO_SITE = False

# Whether to allow non authenticated people to create maps.
UMAP_ALLOW_ANONYMOUS = True

# This setting will exclude empty maps (in fact, it will exclude all maps where
# the default center has not been updated)
UMAP_EXCLUDE_DEFAULT_MAPS = True

# How many maps should be showcased on the main page resp. on the user page
UMAP_MAPS_PER_PAGE = 5
# How many maps should be looked for when performing a (sub)search
UMAP_MAPS_PER_SEARCH = 15
# How many maps should be showcased on the user page, if owner
UMAP_MAPS_PER_PAGE_OWNER = 10

SITE_URL = "https://{{ umap__server_url }}"
#SHORT_SITE_URL = "http://s.hort"

# POSTGIS_VERSION = (2, 1, 0)
#EMAIL_BACKEND = "django.core.mail.backends.console.EmailBackend"
DEFAULT_FROM_EMAIL = "noreply@openstreetmap.de"
EMAIL_BACKEND = "django.core.mail.backends.smtp.EmailBackend"
EMAIL_HOST = "mail2.fossgis.de"
EMAIL_PORT = 25

# You need to unable accent extension before using UMAP_USE_UNACCENT
# python manage.py dbshell
# CREATE EXTENSION unaccent;
UMAP_USE_UNACCENT = False

# Put the site in readonly mode (useful for migration or any maintenance)
UMAP_READONLY = False

# WebSocket support for live collaboration
REALTIME_ENABLED = True

# ASGI configuration for WebSocket support
ASGI_APPLICATION = 'umap.asgi.application'

# Cache configuration for WebSocket support
CACHES = {
    "default": {
        "BACKEND": "django.core.cache.backends.filebased.FileBasedCache",
        "LOCATION": "{{ umap__paths.container.cache }}",
    }
}

# Redis configuration for realtime functionality
REDIS_URL = "redis://redis:6379"

# X-Accel-Redirect for secure GeoJSON delivery
UMAP_XSENDFILE_HEADER = "X-Accel-Redirect"

#For static deployment
STATIC_ROOT = '{{ umap__paths.container.static_root }}'
STATIC_URL = '/static/'

#For users' statics (geojson mainly)
MEDIA_ROOT = '{{ umap__paths.container.media_root }}'

# Default map location for new maps
LEAFLET_LONGITUDE = 2
LEAFLET_LATITUDE = 51
LEAFLET_ZOOM = 6

# Number of old version to keep per datalayer.
UMAP_KEEP_VERSIONS = 10

UMAP_CUSTOM_TEMPLATES = '{{ umap__paths.container.basedir }}/custom/templates'
UMAP_CUSTOM_STATICS = '{{ umap__paths.container.basedir }}/custom/static'
SITE_ID=2

COMPRESS_ENABLED = True
COMPRESS_OFFLINE = True
UMAP_GZIP = True 

UMAP_IMPORTERS = {
    "overpass": {"url": "https://overpass-api.de/api/interpreter"}
}

# "latest" or "highlighted" or "none"
UMAP_HOME_FEED = "none"

UMAP_HOST_INFOS = {
    "name": "{{ umap__host_info_name }}",
    "url": "{{ umap__host_info_url }}",
    "email": "{{ umap__host_info_contact }}"
}

# Pictograms configuration
UMAP_PICTOGRAMS_COLLECTIONS = {
    "osmic": {
        "path": "{{ umap__paths.container.symbols }}/osmic",
        "attribution": "Osmic Icons",
    },
    "brewery": {
        "path": "{{ umap__paths.container.symbols }}/brewery",
        "attribution": "Sven Geggus",
    },
}
